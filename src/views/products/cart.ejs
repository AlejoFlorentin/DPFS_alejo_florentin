<!DOCTYPE html>
<html lang="en">
  <%- include('../partials/head', { title: '| Carrito', styles: 'cart.css' }) %>
  <body>
    <%- include('../partials/header') %>

    <main class="container mt-5 animate__animated animate__slideInDown">
      <div class="main-cart">
        <% if (cartQuantity > 0) { %>
        <div class="products-cart mb-5">
          <% cart.forEach(product => { %>
          <article class="product">
            <img src="<%= product.img %>" alt="<%= product.title %>" />
            <div class="d-flex flex-row justify-content-evenly align-items-center w-100">
              <div class="quantity">
                <p>Cantidad</p>
                <p class="text-center"><%= product.quantity %></p>
              </div>
              <div class="price">
                <p>Precio</p>
                <p>$ <%= product.price %></p>
              </div>
              <div class="subtotal">
                <p>Subtotal</p>
                <p>$ <%= product.price * product.quantity %></p>
              </div>
            </div>
            <form action="/carrito/eliminarItem/<%= product.id %>?_method=DELETE" method="POST">
              <button type="submit" class="border-0 bg-white">
                <i id="<%= product.id %>" class="delete-btn bx bxs-trash-alt text-danger"></i>
              </button>
            </form>
          </article>
          <% }) %>
        </div>
        <% } if (cartQuantity > 0) { %>
        <div class="cart-products-total d-flex flex-column align-items-center">
          <h4 class="text-center">Resumen</h4>
          <div class="d-flex flex-row justify-content-between border-top border-bottom pt-2 w-75">
            <div class="resume-subtitles">
              <p>Productos</p>
              <p>Envio</p>
              <p>Total</p>
            </div>
            <div class="resume-values d-flex flex-column align-items-end">
              <p id="quantity"><%=cartQuantity%></p>
              <p id="shipment"><%= cartQuantity > 3 ? 'Gratis' : '$ 10.000' %></p>
              <b id="total-buy"
                >$ <%= cart.reduce((acc, product) => acc + product.price * product.quantity, 0)
                %></b
              >
            </div>
          </div>
          <div class="cart-btns d-flex mt-2">
            <form action="/carrito/comprar" method="POST" class="w-100">
              <button id="buy-cart" type="submit" class="btn btn-dark m-1">Comprar</button>
            </form>
            <form action="/carrito/eliminar?_method=DELETE" method="POST" class="w-100">
              <button id="delete-cart" type="submit" class="btn btn-dark m-1">Vaciar</button>
            </form>
          </div>
        </div>
        <% } %>
      </div>

      <% if (cartQuantity === 0) { %>
      <div class="text-center mt-5">
        <i class="bx bxs-sad text-danger fs-1"></i>
        <p>No hay productos en el carrito.</p>
      </div>
      <% } %>
    </main>

    <%- include('../partials/footer') %> <%- include('../partials/wsp') %>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
  </body>
</html>
